<!-- createTodo.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>새로운 Todo 등록</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<div class="container">
    <h2>새로운 Todo 등록</h2>
    <form id="create-task-form">
        <div>
            <label for="task-title">할일 제목:</label>
            <input type="text" id="task-title" name="title" maxlength="24" required>
        </div>
        <div>
            <label for="assignee">담당자:</label>
            <input type="text" id="assignee" name="assignee" required>
        </div>
        <div>
            <label for="priority1">우선순위:</label>
            <label><input type="radio" id="priority1" name="priority" value="1" required> 1순위</label>
            <label><input type="radio" id="priority2" name="priority" value="2" required> 2순위</label>
            <label><input type="radio" id="priority3" name="priority" value="3" required> 3순위</label>
        </div>
        <div>
            <button type="button" onclick="goBack()">이전</button>
            <button type="submit">제출</button>
            <button type="button" onclick="clearForm()">내용 지우기</button>
        </div>
    </form>
</div>

<script>
    // 이전 버튼 클릭 시 메인 페이지로 이동
    function goBack() {
        window.location.href = 'index.html';
    }

    // 내용 지우기 버튼 클릭 시 폼 내용 초기화
    function clearForm() {
        document.getElementById('create-task-form').reset();
    }

    // 폼 제출 시 데이터 전송
    document.getElementById('create-task-form').addEventListener('submit', function(event) {
        event.preventDefault(); // 페이지 새로고침 방지

        const title = document.getElementById('task-title').value;
        const assignee = document.getElementById('assignee').value;

        // 숫자 → ENUM 문자열 변환
        const priorityValue = document.querySelector('input[name="priority"]:checked')?.value;
        const priority = priorityValue ? `${priorityValue}순위` : null;


        if (title && assignee && priority) {
            // 할일 등록 API 호출
            fetch('/todolist/createTask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    title,
                    assignee,
                    priority,
                    status: 'todo',
                })
            })
                .then(response => {
                    if (response.ok) {
                        alert('할일이 등록되었습니다.');
                        goBack(); // 메인 페이지로 이동
                    } else {
                        alert('할일 등록에 실패했습니다.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('알 수 없는 오류가 발생했습니다.');
                });
        } else {
            alert('모든 필드를 올바르게 입력해주세요.');
        }
    });
</script>
</body>
</html>
